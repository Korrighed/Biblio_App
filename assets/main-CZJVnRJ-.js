import{d as T,r as g,c as k,a as Y,o as _,b,e,t as $,f as C,g as O,h as U,i as M,F as j,j as F,k as R,w as z,l as L,m as E,v as A,u as K,n as Z,p as ee,q as te,s as se,x as oe,y as re}from"./vendor-U-jY_pc-.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=a(t);fetch(t.href,s)}})();const I=()=>new Promise((p,i)=>{const a=indexedDB.open("UserDB",4);a.onupgradeneeded=o=>{const t=o.target.result;if(!t.objectStoreNames.contains("users")){const s=t.createObjectStore("users",{keyPath:"id"});s.createIndex("role","role",{unique:!1}),s.createIndex("resetCode","resetCode",{unique:!1}),s.createIndex("resetCodeExpiration","resetCodeExpiration",{unique:!1})}if(t.objectStoreNames.contains("borrows")){const s=o.currentTarget.transaction.objectStore("borrows");s.indexNames.contains("borrowDate")||s.createIndex("borrowDate","borrowDate",{unique:!1}),s.indexNames.contains("returnDate")||s.createIndex("returnDate","returnDate",{unique:!1})}else{const s=t.createObjectStore("borrows",{keyPath:"id",autoIncrement:!0});s.createIndex("userId","userId",{unique:!1}),s.createIndex("ISBN","ISBN",{unique:!1}),s.createIndex("status","status",{unique:!1}),s.createIndex("returnDate","returnDate",{unique:!1})}},a.onsuccess=o=>{p(o.target.result)},a.onerror=o=>{console.error("Erreur lors de l'ouverture d'IndexedDB :",o),i(o)}}),ne=async p=>{try{const a=await(await fetch("/users.json")).json(),o=p.transaction("users","readwrite"),t=o.objectStore("users");for(const s of a){const n=t.get(s.id);n.onsuccess=u=>{const r=u.target.result;r?(r.login=r.login||s.login,r.password=r.password||s.password,r.role=r.role||s.role,t.put(r)):t.add(s)},n.onerror=u=>{console.error("Erreur lors de la récupération de l'utilisateur :",u)}}o.oncomplete=()=>{console.log("Transaction terminée avec succès")}}catch(i){console.error("Erreur lors du chargement des utilisateurs :",i)}},ae=async()=>{const o=(await I()).transaction("users","readonly").objectStore("users").getAll();o.onsuccess=t=>{},o.onerror=t=>{console.error("Erreur lors de la récupération des utilisateurs :",t)}};(async()=>(await I(),await ae()))();const B=T("userStore",()=>{const p=g(null);return{currentUser:p,login:async(o,t)=>{const r=(await I()).transaction("users","readonly").objectStore("users").getAll();return new Promise((d,v)=>{r.onsuccess=l=>{const w=l.target.result;console.log("Données récupérées depuis IndexedDB :",w);const y=w.find(c=>c.login===o);if(console.log("Utilisateur trouvé :",y),!y){v("Nom d'utilisateur introuvable !");return}if(atob(y.password)!==t){v("Mot de passe incorrect !");return}p.value=y,console.log("Utilisateur connecté :",p.value),d("Connexion réussie !")},r.onerror=l=>{console.error("Erreur lors de la connexion :",l),v("Erreur lors de la connexion.")}})},logout:()=>{p.value=null,console.log("Déconnexion réussie !")}}}),q=T("bookStore",()=>{const p=g([]),i=g("");async function a(){try{const n=await Y.get("./livres.json");p.value=n.data.livres}catch(n){console.error("Erreur chargement livres:",n)}}const o=k(()=>i.value.trim()?p.value.filter(n=>n.titre.toLowerCase().includes(i.value.toLowerCase())||n.auteur.toLowerCase().includes(i.value.toLowerCase())):p.value);function t(n){return p.value.find(u=>u.ISBN===n)}function s(n){i.value=n}return{bookData:p,searchQuery:i,fetchBooks:a,filteredBooks:o,findBook:t,updateSearchQuery:s}}),V=T("borrowStore",()=>{const p=g([]),i=g([]),a=g([]),o=B(),t=g(!1),s=k(()=>i.value.filter(l=>l.status==="borrowed")),n=k(()=>a.value);async function u(l){const c=(await I()).transaction("borrows","readwrite").objectStore("borrows"),f={userId:o.currentUser.id,ISBN:l,borrowDate:new Date().toISOString(),status:"borrowed",returnDate:null};await new Promise(m=>{c.add(f).onsuccess=m}),r(l,o.currentUser.id,"borrowed"),await d()}function r(l,w,y){const c={isbn:l,userId:w,action:y,timestamp:new Date().toISOString()};p.value.push(c)}async function d(){if(!t.value){t.value=!0;try{const y=(await I()).transaction("borrows","readonly").objectStore("borrows");return new Promise((c,f)=>{const m=y.getAll();m.onsuccess=h=>{const S=h.target.result;a.value=S,i.value=S,c()},m.onerror=h=>{console.error("Erreur chargement emprunts:",h),f(h)}})}finally{t.value=!1}}}async function v(l){if(!t.value){t.value=!0;try{const c=(await I()).transaction("borrows","readwrite").objectStore("borrows"),f=c.index("ISBN");return new Promise((m,h)=>{const S=f.getAll(l);S.onsuccess=async x=>{const N=x.target.result.filter(D=>{var J;return D.userId===((J=o.currentUser)==null?void 0:J.id)}).find(D=>D.status==="borrowed");if(!N){h(new Error(`Aucun emprunt actif trouvé pour l'ISBN: ${l}`));return}N.status="returned",N.returnDate=new Date().toISOString();const G=c.put(N);G.onsuccess=()=>{var D;r(l,(D=o.currentUser)==null?void 0:D.id,"returned"),m()},G.onerror=D=>h(D)},S.onerror=x=>h(x)})}finally{t.value=!1}}}return{borrowHistory:p,borrowBook:u,returnBook:v,activeLoans:s,allLoans:n,loadActiveLoans:d,isLoading:t}}),ue={class:"modal-overlay"},ie={class:"container"},le={class:"row justify-content-center"},ce={class:"row"},de={class:"card p-0 pb-1 col-12"},ve={class:"row"},me={class:"col-4 my-auto"},pe=["src"],fe={class:"col-8"},_e={class:"card-body text-start"},be={class:"card-title fs-1 fw-bold"},we={class:"card-text fs-4 fw-medium"},ge={class:"card-text fs-4"},ye={class:"card-text fs-5"},he={__name:"empruntCardComponent",props:{isbn:{type:String,required:!0}},emits:["close","confirm-emprunt"],setup(p,{emit:i}){const a=q(),o=B(),t=V(),s=p,n=i,u=k(()=>o.currentUser),r=k(()=>a.bookData.find(l=>l.ISBN===s.isbn)),d=async()=>{u.value?(await t.borrowBook(s.isbn),n("confirm-emprunt",s.isbn),n("close")):console.error("Utilisateur non connecté")},v=()=>{n("close")};return(l,w)=>{var y,c,f,m,h,S;return _(),b("div",ue,[e("div",ie,[e("div",le,[e("div",ce,[e("div",de,[e("div",ve,[e("button",{onClick:v,class:"btn-close col-6"}),e("div",me,[e("img",{src:((y=r.value)==null?void 0:y.image)||"default-cover.jpg",class:"img-fluid rounded-start ms-1 mt-lg-4",alt:"couverture"},null,8,pe)]),e("div",fe,[e("div",_e,[e("p",be,$((c=r.value)==null?void 0:c.titre),1),e("p",we," Auteur : "+$(((f=r.value)==null?void 0:f.auteur)||"Auteur inconnu"),1),e("p",ge,"État : "+$((m=r.value)==null?void 0:m.etat),1),e("p",ye,"ISBN : "+$((h=r.value)==null?void 0:h.ISBN),1)]),!((S=r.value)!=null&&S.status)||r.value.status==="returned"?(_(),b("button",{key:0,class:"btn btn-primary col-md-5 col-sm-10",onClick:d}," Confirmer l'emprunt ")):C("",!0)])])])])])])])}}},Q=(p,i)=>{const a=p.__vccOpts||p;for(const[o,t]of i)a[o]=t;return a},$e={class:"container m-0"},Se={class:"radio-menu row"},ke={class:"col"},xe={key:0},Ce=["checked"],Ie=["disabled"],Be={class:"col"},De=["checked"],Ue={__name:"dispoComponent",props:{isbn:{type:String,required:!0}},setup(p){q();const i=B(),a=V(),o=g(!1),t=g(!0),s=p;O(async()=>{await a.loadActiveLoans(),t.value=!1});const n=k(()=>a.activeLoans.some(l=>l.ISBN===s.isbn&&l.status==="borrowed")),u=k(()=>i.currentUser),r=k(()=>u.value&&!n.value&&!t.value),d=async()=>{o.value=!0},v=async l=>{if(l&&!n.value){t.value=!0;try{await a.borrowBook(s.isbn),await a.loadActiveLoans()}catch(w){console.error("Erreur lors de l'emprunt:",w)}finally{t.value=!1}}o.value=!1};return(l,w)=>(_(),b("div",$e,[e("div",Se,[e("div",ke,[r.value?C("",!0):(_(),b("label",xe,[e("input",{type:"radio",checked:!n.value,disabled:""},null,8,Ce),w[0]||(w[0]=U(" Disponible "))])),r.value?(_(),b("button",{key:1,onClick:d,class:"btn btn-primary",disabled:t.value}," Emprunter ",8,Ie)):C("",!0)]),e("div",Be,[e("label",null,[e("input",{type:"radio",checked:n.value,disabled:""},null,8,De),w[1]||(w[1]=U(" Indisponible "))])])]),o.value?(_(),M(he,{key:0,onClose:v,isbn:s.isbn},null,8,["isbn"])):C("",!0)]))}},Ne=Q(Ue,[["__scopeId","data-v-86ae19d5"]]),Ee={class:"row m-1 align-item-center"},Ae={class:"row g-0"},Pe={class:"col-4"},qe=["src"],Re={class:"col-8 p-0 m-0"},Le={class:"card-body"},je={class:"card-title"},Me={class:"card-text"},Te={class:"card-text fs-6"},Oe={class:"card-text"},Ve={class:"row"},W={__name:"bookCardComponent",props:{books:{type:Array,required:!0}},setup(p){return(i,a)=>(_(),b("div",Ee,[(_(!0),b(j,null,F(p.books,(o,t)=>(_(),b("div",{class:"card justify-content-between p-0 col-lg-2 col-sm-5",key:t},[e("div",Ae,[e("div",Pe,[e("img",{src:o.image||"default-cover.jpg",class:"img-fluid rounded-start ms-1 mt-lg-4",alt:"couverture"},null,8,qe)]),e("div",Re,[e("div",Le,[e("h5",je,$(o.titre),1),e("p",Me,"Auteur : "+$(o.auteur||"Auteur inconnu"),1),e("p",Te,"ISBN : "+$(o.ISBN),1),e("p",Oe,"État : "+$(o.etat),1)])]),e("div",Ve,[R(Ne,{isbn:o.ISBN,emprunt:o.emprunt},null,8,["isbn","emprunt"])])])]))),128))]))}},H=T("passwordStore",()=>{const p=g(!1),i=g(null),a=g(null),o=g(null),t=()=>Math.floor(1e5+Math.random()*9e5).toString(),s=async v=>{const y=(await I()).transaction("users","readwrite").objectStore("users");return new Promise((c,f)=>{const m=y.get(v);m.onsuccess=h=>{const S=h.target.result;if(!S){f("Utilisateur non trouvé");return}if(S.resetCode&&S.resetCodeExpiration>Date.now()){f("Une demande de réinitialisation est déjà en cours");return}const x=t(),P=Date.now()+3*60*1e3;i.value=v,a.value=x,o.value=P,p.value=!0,S.resetCode=x,S.resetCodeExpiration=P;const N=y.put(S);N.onsuccess=()=>c(x),N.onerror=()=>f("Erreur lors de la sauvegarde du code")},m.onerror=()=>f("Erreur lors de l'accès à la base de données")})},n=async(v,l)=>{const c=(await I()).transaction("users","readonly").objectStore("users");return new Promise((f,m)=>{const h=c.get(v);h.onsuccess=S=>{const x=S.target.result;if(!x||!x.resetCode){m("Aucune demande de réinitialisation en cours");return}if(Date.now()>x.resetCodeExpiration){m("Code expiré");return}if(x.resetCode!==l){m("Code incorrect");return}f(!0)},h.onerror=()=>m("Erreur lors de la vérification du code")})},u=async(v,l)=>{const c=(await I()).transaction("users","readwrite").objectStore("users");return new Promise((f,m)=>{const h=c.get(v);h.onsuccess=S=>{const x=S.target.result;if(!x){m("Utilisateur non trouvé");return}x.password=btoa(l),x.resetCode=null,x.resetCodeExpiration=null;const P=c.put(x);P.onsuccess=()=>{r(),f("Mot de passe mis à jour avec succès")},P.onerror=()=>m("Erreur lors de la mise à jour du mot de passe")},h.onerror=()=>m("Erreur lors de l'accès à la base de données")})},r=()=>{p.value=!1,i.value=null,a.value=null,o.value=null};return{resetInProgress:p,currentResetUserId:i,currentResetCode:a,resetCodeExpiration:o,initiatePasswordReset:s,validateResetCode:n,updatePassword:u,clearResetRequest:r,checkActiveReset:async v=>{const y=(await I()).transaction("users","readonly").objectStore("users");return new Promise(c=>{const f=y.get(v);f.onsuccess=m=>{const h=m.target.result;if(!h||!h.resetCode||Date.now()>h.resetCodeExpiration){c(!1);return}c(!0)},f.onerror=()=>c(!1)})}}}),Fe={class:"containermin-vh-25 py-0 header"},ze={class:"row mt-1 justify-content-start"},Qe={class:"col-4 col-md-4 text-center"},He={class:"row my-1 justify-content-center justify-content-md-start"},Ge={class:"col-11 col-md-4"},Je={class:"containermin-vh-25 py-0 header"},Ke={key:0,class:"row mt-2 justify-content-center"},We={class:"col-12"},Xe={class:"alert alert-warning"},Ye={__name:"headerComponent",emits:["showConnexion","navigateToAdmin"],setup(p){const i=H(),a=k(()=>i.resetInProgress),o=B(),t=k(()=>o.currentUser);console.log("Utilisteur connecté dans le store:",t.value);const s=q(),n=g(""),u=()=>{s.updateSearchQuery(n.value)};return z(()=>t.value,(r,d)=>{console.log("Changement de currentUser :",d,"->",r)}),console.log("Instance du userStore :",o),(r,d)=>{var v;return _(),b("div",Fe,[e("div",ze,[d[4]||(d[4]=e("div",{class:"col-8 col-md-8 fs-5 text-center"}," Bienvenu sur l'intranet des amoureux du livre ",-1)),e("div",Qe,[e("button",{onClick:d[0]||(d[0]=l=>t.value?r.$emit("navigateToAdmin"):r.$emit("showConnexion")),type:"button",class:"btn btn-secondary"},$(t.value?t.value.login:"Connexion"),1)])]),e("div",He,[e("div",Ge,[e("form",{onSubmit:d[2]||(d[2]=L(()=>{},["prevent"]))},[E(e("input",{type:"text",placeholder:"Rechercher un livre ou un auteur...","onUpdate:modelValue":d[1]||(d[1]=l=>n.value=l),onInput:u,class:"form-control"},null,544),[[A,n.value]])],32)])]),e("div",Je,[((v=t.value)==null?void 0:v.role)==="admin"&&a.value?(_(),b("div",Ke,[e("div",We,[e("div",Xe,[d[5]||(d[5]=U(" Une demande de réinitialisation de mot de passe est en cours. ")),e("button",{onClick:d[3]||(d[3]=l=>r.$emit("navigateToAdmin")),class:"btn btn-sm btn-warning ms-2"}," Voir les détails ")])])])):C("",!0)])])}}},Ze={class:"reset-password-container row"},et={class:"mb-2"},tt=["disabled"],st={key:0,class:"alert alert-warning"},ot={class:"mb-2"},rt={class:"mb-2"},nt=["disabled"],at={key:0,class:"alert alert-danger mt-3"},ut={key:1,class:"alert alert-success mt-3"},it={__name:"resetPasswordComponent",emits:["close"],setup(p,{emit:i}){const a=H(),o=g(""),t=g(""),s=g(""),n=g(1),u=g(""),r=g(""),d=g(!1),v=g(!1),l=k(()=>n.value===1?"Valider l'identifiant":v.value?"Réinitialiser le mot de passe":"En attente du code"),w=async()=>{if(o.value)try{const f=await a.checkActiveReset(o.value);v.value=f}catch(f){console.error("Erreur lors de la vérification du code:",f)}},y=async()=>{u.value="",r.value="",d.value=!0;try{n.value===1?(await a.checkActiveReset(o.value)?(r.value="Une demande est déjà en cours. Contactez un administrateur pour recevoir votre code.",v.value=!0):(await a.initiatePasswordReset(o.value),r.value="Demande enregistrée. Contactez un administrateur pour recevoir votre code."),n.value=2):v.value&&(await a.validateResetCode(o.value,t.value),await a.updatePassword(o.value,s.value),r.value="Mot de passe mis à jour avec succès",setTimeout(()=>{c("close")},2e3))}catch(f){u.value=f}finally{d.value=!1}};z(()=>n.value,async f=>{if(f===2){await w();const m=setInterval(async()=>{v.value?clearInterval(m):await w()},5e3)}});const c=i;return(f,m)=>(_(),b("div",Ze,[m[6]||(m[6]=e("h4",{class:"text-center mb-4"},"Réinitialisation du mot de passe",-1)),e("form",{onSubmit:L(y,["prevent"]),class:"w-100"},[e("div",et,[m[3]||(m[3]=e("label",{class:"form-label"},"Identifiant associatif :",-1)),E(e("input",{"onUpdate:modelValue":m[0]||(m[0]=h=>o.value=h),type:"text",class:"form-control",disabled:n.value!==1,required:""},null,8,tt),[[A,o.value]])]),n.value===2&&!v.value?(_(),b("div",st," Contactez un administrateur pour recevoir votre code de réinitialisation ")):C("",!0),n.value===2&&v.value?(_(),b(j,{key:1},[e("div",ot,[m[4]||(m[4]=e("label",{class:"form-label"},"Code de réinitialisation :",-1)),E(e("input",{"onUpdate:modelValue":m[1]||(m[1]=h=>t.value=h),type:"text",class:"form-control",maxlength:"6",pattern:"\\d{6}",required:""},null,512),[[A,t.value]])]),e("div",rt,[m[5]||(m[5]=e("label",{class:"form-label"},"Nouveau mot de passe :",-1)),E(e("input",{"onUpdate:modelValue":m[2]||(m[2]=h=>s.value=h),type:"password",class:"form-control",required:""},null,512),[[A,s.value]])])],64)):C("",!0),e("button",{type:"submit",class:"btn btn-primary d-block mx-auto",disabled:d.value||n.value===2&&!v.value},$(l.value),9,nt)],32),u.value?(_(),b("div",at,$(u.value),1)):C("",!0),r.value?(_(),b("div",ut,$(r.value),1)):C("",!0)]))}},lt=Q(it,[["__scopeId","data-v-fa547607"]]),ct={class:"modal-overlay"},dt={class:"container"},vt={class:"row justify-content-center"},mt={class:"modal-content col-lg-4 col-sm-5 mx-auto"},pt={key:0},ft={class:"text-center"},_t={key:0,class:"mb-2 col-12"},bt={class:"mb-2 col-12"},wt={class:"mb-2 col-12"},gt={type:"submit",class:"btn btn-primary col-5 mt-2 mx-auto d-block"},yt={class:"text-center mt-3"},ht={key:0,class:"text-danger mt-2"},$t={key:1,class:"text-success mt-2"},St={key:1},kt={class:"text-center mt-2"},xt={__name:"logginModalComponent",emits:["close"],setup(p,{emit:i}){const a=i,o=g(!1),t=g(!0),s=g(""),n=g(""),u=g(""),r=g(""),d=g(""),v=B(),l=()=>{t.value=!t.value},w=async()=>{if(r.value="",d.value="",!n.value||!u.value){r.value="Tous les champs doivent être remplis.";return}if(t.value)try{const y=await v.login(n.value,u.value);d.value=y,a("close")}catch(y){console.error("Erreur lors de la connexion :",y),r.value=y}else{if(!s.value){r.value="L'ID associatif est requis pour l'inscription.";return}try{const c=(await I()).transaction("users","readwrite"),f=c.objectStore("users"),m=f.get(s.value);m.onsuccess=h=>{const S=h.target.result;if(!S){r.value="ID associatif non trouvé !";return}if(S.login){r.value="Cet ID est déjà utilisé !";return}S.login=n.value,S.password=btoa(u.value),f.put(S),c.oncomplete=()=>{d.value="Inscription réussie !"},c.onerror=x=>{r.value="Erreur lors de l'inscription."}},m.onerror=h=>{r.value="Erreur lors de la récupération de l'utilisateur."}}catch(y){console.error("Erreur lors de l'inscription :",y),r.value="Une erreur est survenue pendant l'inscription."}}};return(y,c)=>(_(),b("div",ct,[e("div",dt,[e("div",vt,[e("div",mt,[e("button",{onClick:c[0]||(c[0]=f=>y.$emit("close")),class:"btn-close"}),o.value?C("",!0):(_(),b("div",pt,[e("h3",ft,$(t.value?"Connexion":"Inscription"),1),e("form",{onSubmit:L(w,["prevent"]),class:"w-100"},[t.value?C("",!0):(_(),b("div",_t,[c[6]||(c[6]=U(" Identifiant associatif : ")),E(e("input",{"onUpdate:modelValue":c[1]||(c[1]=f=>s.value=f),type:"text",class:"form-control",required:""},null,512),[[A,s.value]])])),e("div",bt,[c[7]||(c[7]=U(" Nom d'utilisateur : ")),E(e("input",{"onUpdate:modelValue":c[2]||(c[2]=f=>n.value=f),type:"text",class:"form-control",required:""},null,512),[[A,n.value]])]),e("div",wt,[c[8]||(c[8]=U(" Mot de passe : ")),E(e("input",{"onUpdate:modelValue":c[3]||(c[3]=f=>u.value=f),type:"password",class:"form-control",required:""},null,512),[[A,u.value]])]),e("button",gt,$(t.value?"Connexion":"S'inscrire"),1),e("p",yt,[U($(t.value?"Pas encore de compte ?":"Déjà inscrit ?")+" ",1),e("a",{href:"#",onClick:L(l,["prevent"])},$(t.value?"Créer un compte":"Se connecter"),1)])],32),r.value?(_(),b("p",ht,$(r.value),1)):C("",!0),d.value?(_(),b("p",$t,$(d.value),1)):C("",!0)])),t.value?(_(),b("div",St,[e("p",kt,[e("a",{href:"#",onClick:c[4]||(c[4]=L(f=>o.value=!0,["prevent"]))}," Mot de passe oublié ? ")]),o.value?(_(),M(lt,{key:0,onClose:c[5]||(c[5]=f=>o.value=!1)})):C("",!0)])):C("",!0)])])])]))}},Ct={class:"row mx-auto"},It={key:0,class:"text-center"},Bt={key:1},Dt={class:"book-info"},Ut={class:"title"},Nt={class:"author"},Et=["onClick","disabled"],At={__name:"UserBorrowedBooks",setup(p){const i=B(),a=V(),o=q(),t=g(null),s=k(()=>a.activeLoans.filter(u=>{var r;return u.userId===((r=i.currentUser)==null?void 0:r.id)}).map(u=>{const r=o.findBook(u.ISBN);return{...u,title:r==null?void 0:r.titre,author:r==null?void 0:r.auteur}})),n=async u=>{try{t.value=u,await a.returnBook(u),await a.loadActiveLoans()}catch(r){console.error("Erreur lors du retour du livre:",r)}finally{t.value=null}};return(u,r)=>(_(),b("div",Ct,[r[0]||(r[0]=e("h3",{class:"m-sm-auto"},"Mes livres empruntés",-1)),K(a).isLoading?(_(),b("div",It," Chargement... ")):(_(),b("ul",Bt,[(_(!0),b(j,null,F(s.value,d=>(_(),b("li",{key:d.ISBN,class:"col-12 border border-bottom-1"},[e("div",Dt,[e("span",Ut,$(d.title),1),e("span",Nt,"par "+$(d.author),1)]),e("button",{class:"btn btn-danger",onClick:v=>n(d.ISBN),disabled:t.value===d.ISBN||K(a).isLoading},$(t.value===d.ISBN?"En cours...":"Rendre"),9,Et)]))),128))]))]))}},Pt={class:"admin-borrows"},qt={class:"table-responsive"},Rt={class:"table table-striped table-hover"},Lt={class:"badge bg-secondary"},jt={class:"badge bg-primary"},Mt={key:0,class:"alert alert-info mt-3"},Tt={__name:"AdminBorrowedBooks",setup(p){const i=q(),a=V();B(),O(async()=>{await a.loadActiveLoans(),await i.fetchBooks()});const o=k(()=>a.allLoans.map(s=>{const n=i.findBook(s.ISBN);return{titre:(n==null?void 0:n.titre)||"Livre inconnu",ISBN:s.ISBN,userId:s.userId,borrowDate:s.borrowDate,returnDate:s.returnDate,status:s.status}})),t=s=>s?new Date(s).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return(s,n)=>(_(),b("div",Pt,[n[1]||(n[1]=e("h3",{class:"mb-4"},"Gestion des Emprunts",-1)),e("div",qt,[e("table",Rt,[n[0]||(n[0]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"Titre"),e("th",null,"ISBN"),e("th",null,"ID Utilisateur"),e("th",null,"Date d'emprunt"),e("th",null,"Date de retour"),e("th",null,"Statut")])],-1)),e("tbody",null,[(_(!0),b(j,null,F(o.value,u=>(_(),b("tr",{key:`${u.ISBN}-${u.userId}-${u.borrowDate}`},[e("td",null,$(u.titre),1),e("td",null,[e("span",Lt,$(u.ISBN),1)]),e("td",null,[e("span",jt,$(u.userId),1)]),e("td",null,$(t(u.borrowDate)),1),e("td",null,$(t(u.returnDate)),1),e("td",null,[e("span",{class:Z(["badge",{"bg-success":u.status==="returned","bg-warning":u.status==="borrowed"}])},$(u.status==="borrowed"?"En cours":"Retourné"),3)])]))),128))])])]),o.value.length===0?(_(),b("div",Mt," Aucun emprunt enregistré pour le moment. ")):C("",!0)]))}},Ot=Q(Tt,[["__scopeId","data-v-df715b66"]]),Vt={class:"container"},Ft={class:"row align-items-start"},zt={key:0,class:"col-12 col-md-8"},Qt={class:"alert alert-info"},Ht={key:1,class:"col-12 col-md-6 d-flex text-center mx-md-auto"},Gt={__name:"resetpasswordAdminComponent",setup(p){const i=H(),a=g(0),o=g(null),t=k(()=>i.currentResetUserId),s=k(()=>i.currentResetCode),n=k(()=>i.resetInProgress),u=k(()=>i.resetCodeExpiration),r=k(()=>{const l=Math.floor(a.value/60),w=a.value%60;return`${l}:${w.toString().padStart(2,"0")}`}),d=()=>{if(!u.value)return;const l=Date.now(),w=Math.floor((u.value-l)/1e3);w<=0?(clearInterval(o.value),i.clearResetRequest(),a.value=0):a.value=w},v=()=>{d(),o.value=setInterval(d,1e3)};return O(()=>{n.value&&v(),z(()=>i.resetInProgress,l=>{l?v():o.value&&clearInterval(o.value)})}),ee(()=>{o.value&&clearInterval(o.value)}),(l,w)=>(_(),b("div",Vt,[e("div",Ft,[n.value?(_(),b("div",zt,[e("div",Qt,[w[1]||(w[1]=e("h5",null,"Demande active",-1)),e("p",null,"ID Utilisateur : "+$(t.value),1),e("p",null,[w[0]||(w[0]=U("Code : ")),e("strong",null,$(s.value),1)]),e("p",null,"Temps restant : "+$(r.value),1)])])):(_(),b("div",Ht,w[2]||(w[2]=[e("div",{class:"alert alert-info text-start"}," Aucune réinitialisation de mot de passe en cours ",-1)])))])]))}},Jt={class:"page-admin"},Kt={class:"row justify-content-evenly my-2 mx-1"},Wt={class:"col-7 fs-5 mb-0"},Xt={key:0},Yt={key:1},Zt={__name:"pageAdminComponent",emits:["logout","navigateToPage"],setup(p,{emit:i}){const a=i,o=B(),t=k(()=>o.currentUser),s=()=>{a("logout")};return(n,u)=>(_(),b("div",Jt,[e("div",Kt,[e("p",Wt," Bienvenue, "+$(t.value.login),1),e("button",{onClick:u[0]||(u[0]=r=>n.$emit("navigateToPage","books")),type:"button",class:"btn btn-info col-4 col-md-2 p-0 me-2"}," Retour à la librairie"),e("button",{onClick:s,type:"button",class:"btn btn-secondary col-4 col-md-2 p-0"}," Déconnexion ")]),t.value.role==="user"?(_(),b("div",Xt,[R(At)])):t.value.role==="admin"?(_(),b("div",Yt,[R(Gt),R(Ot)])):C("",!0)]))}},es={class:"row"},ts={class:"row"},ss={__name:"App",setup(p){const i=g(!1),a=g("books"),o=B(),t=q();O(()=>{t.fetchBooks()});const s=d=>{a.value=d},n=()=>{o.logout(),s("books")},u=k(()=>a.value==="admin"?Zt:W),r=k(()=>u.value===W?{books:t.filteredBooks}:{});return(d,v)=>(_(),b(j,null,[e("div",es,[R(Ye,{onShowConnexion:v[0]||(v[0]=l=>i.value=!0),onNavigateToAdmin:v[1]||(v[1]=l=>s("admin")),onNavigateToBooks:v[2]||(v[2]=l=>s("books"))})]),i.value?(_(),M(xt,{key:0,onClose:v[3]||(v[3]=l=>i.value=!1)})):C("",!0),e("div",ts,[(_(),M(se(u.value),te({onLogout:n,onNavigateToPage:s},r.value),null,16))])],64))}},X=oe(ss),os=re();X.use(os);X.mount("#app");(async()=>{const p=await I();await ne(p)})();
